id: app.twintaillauncher.ttl

runtime: org.gnome.Platform
runtime-version: '48'
sdk: org.gnome.Sdk

command: twintaillauncher
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=session-bus
  - --socket=pulseaudio
  - --device=dri # OpenGL
  - --share=ipc
  - --share=network
  - --filesystem=home
  - --filesystem=xdg-run/tray-icon:create
  - --talk-name=org.kde.StatusNotifierWatcher
  - --talk-name=org.freedesktop.portal.Desktop
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.freedesktop.Flatpak
  - --talk-name=org.freedesktop.DBus
  - --allow=devel

modules:
  - shared-modules/libappindicator/libappindicator-gtk3-12.10.json
  - name: binary
    buildsystem: simple
    sources:
      - type: file
        url: https://github.com/TwintailTeam/TwintailLauncher/releases/download/ttl-v0.1.0-test/twintaillauncher_0.1.0_amd64.deb
        sha256: 83af6cf60c4fc4b3fd580cdcecc65e58b526b542f0e34a3f4480e8afc5d47fab
        only-arches: [x86_64]
    build-commands:
      - ar -x *.deb
      - tar -xf data.tar.gz
      - 'install -Dm755 usr/bin/twintaillauncher /app/bin/twintaillauncher'
      - install -Dm644 usr/share/applications/twintaillauncher.desktop /app/share/applications/app.twintaillauncher.ttl.desktop
      - install -Dm644 usr/share/icons/hicolor/128x128/apps/twintaillauncher.png /app/share/icons/hicolor/128x128/apps/app.twintaillauncher.ttl.png
      - install -Dm644 usr/share/icons/hicolor/32x32/apps/twintaillauncher.png /app/share/icons/hicolor/32x32/apps/app.twintaillauncher.ttl.png
      - install -Dm644 usr/share/icons/hicolor/256x256@2/apps/twintaillauncher.png /app/share/icons/hicolor/256x256@2/apps/app.twintaillauncher.ttl.png
      - install -Dm644 app/share/metainfo/app.twintaillauncher.ttl.metainfo.xml /app/share/metainfo/app.twintaillauncher.ttl.metainfo.xml
      - install -Dm755 usr/lib/twintaillauncher/resources/hpatchz /app/lib/twintaillauncher/resources/hpatchz
      - install -Dm755 usr/lib/twintaillauncher/resources/hpatchz_kuro.exe /app/lib/twintaillauncher/resources/hpatchz_kuro.exe
      - sed -i 's/^Icon=.*/Icon=app.twintaillauncher.ttl/' /app/share/applications/app.twintaillauncher.ttl.desktop
