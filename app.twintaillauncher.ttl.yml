id: app.twintaillauncher.ttl

runtime: org.gnome.Platform
runtime-version: '48'
sdk: org.gnome.Sdk

only-arches:
  - x86_64

command: twintaillauncher
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio # Some of the launcher supported games need this to even launch
  - --device=all # Controller support, specifically handhelds like steamdeck
  - --share=ipc # Tauri IPC
  - --share=network # Download supported games and runners
  - --filesystem=xdg-run/tray-icon:create # System tray icon
  - --talk-name=org.kde.StatusNotifierWatcher # System tray icon
  - --talk-name=org.freedesktop.Notifications # Notifications for some reason they dont show otherwise
  - --allow=devel # Needed by wine

modules:
  - shared-modules/libappindicator/libappindicator-gtk3-12.10.json
  - name: twintaillauncher
    buildsystem: simple
    sources:
      - type: file
        url: https://github.com/TwintailTeam/TwintailLauncher/releases/download/ttl-v1.0.1/twintaillauncher_1.0.1_amd64.deb
        sha256: b24fc929777ddf1cc150cca59188ebb7b71b2f5173a584f57773bd613c66d5b9
        only-arches: [x86_64]
        skip-arches: [aarch64]
    build-commands:
      - ar -x *.deb
      - tar -xf data.tar.gz
      - 'install -Dm755 usr/bin/twintaillauncher /app/bin/twintaillauncher'
      - install -Dm644 usr/share/applications/twintaillauncher.desktop /app/share/applications/app.twintaillauncher.ttl.desktop
      - install -Dm644 usr/share/icons/hicolor/128x128/apps/twintaillauncher.png /app/share/icons/hicolor/128x128/apps/app.twintaillauncher.ttl.png
      - install -Dm644 usr/share/icons/hicolor/32x32/apps/twintaillauncher.png /app/share/icons/hicolor/32x32/apps/app.twintaillauncher.ttl.png
      - install -Dm644 usr/share/icons/hicolor/256x256@2/apps/twintaillauncher.png /app/share/icons/hicolor/256x256@2/apps/app.twintaillauncher.ttl.png
      - install -Dm644 app/share/metainfo/app.twintaillauncher.ttl.metainfo.xml /app/share/metainfo/app.twintaillauncher.ttl.metainfo.xml
      - install -Dm755 usr/lib/twintaillauncher/resources/hpatchz /app/lib/twintaillauncher/resources/hpatchz
      - install -Dm755 usr/lib/twintaillauncher/resources/hpatchz_kuro.exe /app/lib/twintaillauncher/resources/hpatchz_kuro.exe
      - desktop-file-edit --set-icon=app.twintaillauncher.ttl /app/share/applications/app.twintaillauncher.ttl.desktop
